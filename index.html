<!doctype html>
<html>
<head>
	<title>Live input effects</title>
	<script src="js/effect.js"></script>
	<script src="js/waveshaper.js"></script>
	<script src="js/jungle.js"></script>
	<script src="js/effects.js"></script>
	<script src="js/pingpong.js"></script>
	<script src="js/apollo.js"></script>

	<!-- Visualizer stuff -->
	<script src="js/visualizer/events.js"></script>
	<script src="js/visualizer/base.js"></script>
	<script src="js/visualizer/cameracontroller.js"></script>
	<script src="js/visualizer/matrix4x4.js"></script>
	<script src="js/visualizer/visualizer.js"></script>
	<script src="js/visualizer/shader.js"></script>

	<style>
	body { font: 14pt Arial, sans-serif; background: #333; color: grey; }
	select { font: 14pt Arial, sans-serif; }
	div#controls div { display:none; border: 1px solid darkgray; border-radius: 5px; padding: 10px; width: 728px;}
	div#controls div.display { display: block; }
	#controls { padding-top: 24px;}
	#effectMix { padding-top: 12px;}
	#arranger { width:750px; margin: 25px auto}
	#autoplay { width: 100%; height: 100%; }
	</style>
</head>
<body>
	<div id="autoplay">
		<button onclick="audioContext.resume(); changeInput(); document.getElementById('autoplay').style='display:none';">Start Processing</button>
	</div>

	<div>Input:
		<select id="audioinput" onchange="changeInput(this.selectedIndex);">
			<option>default (selection not supported)</option>
		</select>
	</div>

	<div id="arranger">
	<canvas id="view1" width="750" height="200"></canvas><br>
	<canvas id="view2" width="750" height="200"></canvas>
	<div>
		<input type="radio" name="radioSet" value="data" 
		onmousedown="analyserView1.setAnalysisType(ANALYSISTYPE_FREQUENCY); analyserView2.setAnalysisType(ANALYSISTYPE_FREQUENCY);">Frequency
		<input type="radio" name="radioSet" value="data" 
		onmousedown="analyserView1.setAnalysisType(ANALYSISTYPE_SONOGRAM); analyserView2.setAnalysisType(ANALYSISTYPE_SONOGRAM);">Sonogram
		<input type="radio" name="radioSet" value="data" checked="checked" 
		onmousedown="analyserView1.setAnalysisType(ANALYSISTYPE_3D_SONOGRAM); analyserView2.setAnalysisType(ANALYSISTYPE_3D_SONOGRAM);">3D Sonogram
		<input type="radio" name="radioSet" value="data" 
		onmousedown="analyserView1.setAnalysisType(ANALYSISTYPE_WAVEFORM); analyserView2.setAnalysisType(ANALYSISTYPE_WAVEFORM);">Waveform
	</div>

	<div id="effectMix">
		Effect A: 
		<select id="effectA" onchange="setEffects(this.selectedIndex, document.getElementById('effectB').selectedIndex)">
			<option>Delay</option>
			<option>Reverb</option>
			<option>Distortion</option>
			<option>Chorus</option>
			<option>Flange</option>
			<option>Ping-pong delay</option>
			<option>LFO Filter</option>
		</select>
		Effect B: 
		<select id="effectB" onchange="setEffects(document.getElementById('effectA').selectedIndex, this.selectedIndex)">
			<option>Delay</option>
			<option>Reverb</option>
			<option>Distortion</option>
			<option>Chorus</option>
			<option>Flange</option>
			<option>Ping-pong delay</option>
			<option>LFO Filter</option>
		</select>
		Effect Mix: 
		<input type="range" min="0.0" max="1.0" step="0.01" value="0.5" style="height: 20px; width: 200px;" 
		onInput="crossfade(event.target.value);">
	</div>

	<div id="controls">
		<!-- Seus controles de delay, reverb, distorção etc continuam iguais -->
	</div>

	</div>
  <a href="https://github.com/cwilso/Audio-Input-Effects" style="position: absolute; z-index:2; top: 0; right: 0; border: 0;"><img src="img/forkme.png" alt="Fork me on GitHub"></a>

  <script>
  // Exemplo básico JS para crossfade
  let gainA = audioContext.createGain();
  let gainB = audioContext.createGain();
  gainA.connect(audioContext.destination);
  gainB.connect(audioContext.destination);
  let effectA = null;
  let effectB = null;

  function setEffects(indexA, indexB) {
      if (effectA) effectA.disconnect();
      if (effectB) effectB.disconnect();
      // Substitua estas linhas pelas funções que criam seus efeitos
      effectA = createEffectByIndex(indexA);
      effectB = createEffectByIndex(indexB);
      audioInput.connect(effectA);
      audioInput.connect(effectB);
      effectA.connect(gainA);
      effectB.connect(gainB);
  }

  function crossfade(value) {
      gainA.gain.value = 1 - value;
      gainB.gain.value = value;
  }
  </script>

</body>
</html>
